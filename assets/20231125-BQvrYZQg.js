import{_ as g}from"./ValaxyMain.vue_vue_type_style_index_0_lang-z2ydsarW.js";import{a as d,p as o,o as u,c as m,w as t,f as y,v as F,g as s,h as l,r as n}from"./app-C80GHJBF.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-wsAdurQX.js";import"./YunCard.vue_vue_type_script_setup_true_lang-Cg7J7Tlp.js";import"./index-C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-DsXax-cb.js";import"./index-C7yU5XnD.js";import"./post-BFKQUWlS.js";const q={__name:"20231125",setup(b,{expose:k}){const e=JSON.parse('{"title":"一次小米4A刷入openwrt的失败历程","description":"","frontmatter":{"title":"一次小米4A刷入openwrt的失败历程","date":"2023-11-25T00:00:00.000Z","updated":"2023-11-25T00:00:00.000Z","categories":["笔记"],"tags":["总结","openwrt"]},"headers":[{"level":2,"title":"远程登录到路由器","slug":"远程登录到路由器","link":"#远程登录到路由器","children":[]},{"level":2,"title":"获取合适的openwrt版本","slug":"获取合适的openwrt版本","link":"#获取合适的openwrt版本","children":[]},{"level":2,"title":"问题点解决","slug":"问题点解决","link":"#问题点解决","children":[]},{"level":2,"title":"最终","slug":"最终","link":"#最终","children":[]}],"relativePath":"pages/posts/20231125.md","path":"/home/runner/work/lateautumn2.github.io/lateautumn2.github.io/pages/posts/20231125.md","lastUpdated":1725506944000}'),p=d(),r=e.frontmatter||{};return p.meta.frontmatter=Object.assign(p.meta.frontmatter||{},e.frontmatter||{}),o("pageData",e),o("valaxy:frontmatter",r),globalThis.$frontmatter=r,k({frontmatter:{title:"一次小米4A刷入openwrt的失败历程",date:"2023-11-25T00:00:00.000Z",updated:"2023-11-25T00:00:00.000Z",categories:["笔记"],tags:["总结","openwrt"]}}),(a,i)=>{const h=g;return u(),m(h,{frontmatter:y(r)},{"main-content-md":t(()=>[F(" more "),i[0]||(i[0]=s("blockquote",null,[s("p",null,"写在前面")],-1)),i[1]||(i[1]=s("p",null,"很早就想过要在路由中搭建一个透明代理，在局域网下的设备就不用每次都需要开启GUI了，之前尝试过使用手机做旁路由实现网关代理，可是总是会存在各种各样的问题，诸如分流，断网…于是就不了了之。由于从未接触过openwrt，在脑海中下意识的就觉得它很难，每次都望而却步，今天上班摸鱼时，又又又刷到了透明代理的帖子，于是乎，‘要不就试一把？’。就有了以下文章，在此次刷openwrt前，我也看查找了不少帖子，论坛，本次操作就参考了下面这篇博客,本文的大部分操作都与之无异，在此基础上更新了部分问题的解决方案。",-1)),i[2]||(i[2]=s("p",null,[s("a",{href:"https://huweicai.com/run-openwrt-on-xiaomi4a100m/",target:"_blank",rel:"noreferrer"},"小米路由器4A百兆版刷OpenWRT")],-1)),i[3]||(i[3]=s("h2",{id:"远程登录到路由器",tabindex:"-1"},[l("远程登录到路由器 "),s("a",{class:"header-anchor",href:"#远程登录到路由器","aria-label":'Permalink to "远程登录到路由器"'},"​")],-1)),i[4]||(i[4]=s("ul",null,[s("li",null,"更新到存在漏洞的固件版本")],-1)),i[5]||(i[5]=s("p",null,[l("查看github社区，可以知道目前刷入无问题的有三个版本:"),s("code",null,"v2.18.51"),l(","),s("code",null,"v2.18.58"),l(","),s("code",null,"v3.0.12"),l(",我在论坛以及issue中了解到，目前"),s("code",null,"v2.18.51"),l("的反响比较好，所以我使用的版本为"),s("code",null,"v2.18.51"),l("，与原帖主不同，这里我同样放上原贴主提供的固件地址。 "),s("img",{src:"https://pic.0v0.day/file/lateautumn2/picx-images-hosting/master/1700877423443.webp",alt:"imgs"})],-1)),i[6]||(i[6]=s("div",{class:"language-java vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"java"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"小米4A路由器百兆版2."),s("span",{style:{"--shiki-light":"#B31D28","--shiki-dark":"#FDAEB7","--shiki-light-font-style":"italic","--shiki-dark-font-style":"italic"}},"18"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),s("span",{style:{"--shiki-light":"#B31D28","--shiki-dark":"#FDAEB7","--shiki-light-font-style":"italic","--shiki-dark-font-style":"italic"}},"51固件"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"：https"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//pan.baidu.com/s/1DXHZx9puoN9kEY7BDymxqA")]),l(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"小米4A路由器百兆版2."),s("span",{style:{"--shiki-light":"#B31D28","--shiki-dark":"#FDAEB7","--shiki-light-font-style":"italic","--shiki-dark-font-style":"italic"}},"18"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),s("span",{style:{"--shiki-light":"#B31D28","--shiki-dark":"#FDAEB7","--shiki-light-font-style":"italic","--shiki-dark-font-style":"italic"}},"58固件"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"：https"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//pan.baidu.com/s/1DXHZx9puoN9kEY7BDymxqA")]),l(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"提取码：debw")])])]),s("button",{class:"collapse"})],-1)),i[7]||(i[7]=s("p",null,"更新固件：192.168.31.1进入路由器->常用设置->系统状态->手动升级，在弹出窗口中手动选择固件包即可",-1)),i[8]||(i[8]=s("figure",null,[s("img",{src:"https://pic.0v0.day/file/stroage/2024/06/30/gxlgmamo6o.png",alt:"imgs2",loading:"lazy",decoding:"async"})],-1)),i[9]||(i[9]=s("ul",null,[s("li",null,"使用OpenWRTInvasion脚本通过漏洞远程登录")],-1)),i[10]||(i[10]=s("p",null,[l("小米路由器系列路由器存在一个远程执行漏洞：CVE-2019-18370 ，小米魔改的 luci 管理后台有一个接口可以注入 shell 命令执行，我们就可以通过这个漏洞远程执行脚本开启 ssh、telnet 等远程登录服务，或者通过 nc工具配合管道反向shell登录。有人写了一个开放远程登录的脚本："),s("a",{href:"https://github.com/acecilia/OpenWRTInvasion",target:"_blank",rel:"noreferrer"},"openWRTInvasion"),l("，我们可以利用这个脚本来一键登录到路由器上执行我们的刷机命令。")],-1)),i[11]||(i[11]=s("p",null,"在执行脚本前，请确认你已知路由器的登录密码，如果不知道，是自动保存到浏览器的，那就复制地址栏的stok参数，用于脚本的登录校验",-1)),i[12]||(i[12]=s("figure",null,[s("img",{src:"https://pic.0v0.day/file/stroage/2024/06/30/gxlgn2qx1q.png",alt:"imgs3",loading:"lazy",decoding:"async"})],-1)),i[13]||(i[13]=s("p",null,"创建空白目录，执行以下代码",-1)),i[14]||(i[14]=s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"git"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," clone"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," https://github.com/acecilia/OpenWRTInvasion")]),l(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cd"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," OpenWRTInvasion")])])]),s("button",{class:"collapse"})],-1)),i[15]||(i[15]=s("p",null,"如果clone一直10024，可以尝试在github项目下，手动download zip，解压到空白目录中，运行cmd",-1)),i[16]||(i[16]=s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 安装依赖")]),l(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"pip3"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --upgrade"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," pip")]),l(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"pip3"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -r"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," requirements.txt")]),l(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 执行脚本")]),l(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"python3"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," remote_command_execution_vulnerability.py")])])]),s("button",{class:"collapse"})],-1)),i[17]||(i[17]=s("p",null,"执行完毕后会提示输入ip地址：Router IP address[press enter for using the default 'miwifi.com']",-1)),i[18]||(i[18]=s("p",null,"正常输入192.168.31.1即可",-1)),i[19]||(i[19]=s("p",null,"之后会要你输入密码，知道密码就直接输入，不知道就直接留空回车，进入下一步输入上一步骤保存的stok",-1)),i[20]||(i[20]=s("p",null,"接下来会让你选择安装方式，保持默认回车即可",-1)),i[21]||(i[21]=s("p",null,"然后等待执行完成",-1)),i[22]||(i[22]=s("blockquote",null,[s("p",null,"尝试远程登录")],-1)),i[23]||(i[23]=s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"telnet"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 192.168.31.1")])])]),s("button",{class:"collapse"})],-1)),i[24]||(i[24]=s("p",null,[l("如果提示telnet不存在，请查看"),s("a",{href:"https://help.aliyun.com/zh/ecs/enable-the-telnet-command-in-windows",target:"_blank",rel:"noreferrer"},"这里"),l("进行处理")],-1)),i[25]||(i[25]=s("p",null,"在这里请注意，由于原贴主使用的脚本比较老了，用户名为root，密码为空已不适用，请查看上一步脚本执行完后反馈的信息为准",-1)),i[26]||(i[26]=s("figure",null,[s("img",{src:"https://pic.0v0.day/file/stroage/2024/06/30/gxlgnt5s6d.png",alt:"imgs4",loading:"lazy",decoding:"async"})],-1)),i[27]||(i[27]=s("p",null,"进入此页面，代表登录成功了",-1)),i[28]||(i[28]=s("figure",null,[s("img",{src:"https://pic.0v0.day/file/stroage/2024/06/30/gxlgog4urs.png",alt:"imgs5",loading:"lazy",decoding:"async"})],-1)),i[29]||(i[29]=s("h2",{id:"获取合适的openwrt版本",tabindex:"-1"},[l("获取合适的openwrt版本 "),s("a",{class:"header-anchor",href:"#获取合适的openwrt版本","aria-label":'Permalink to "获取合适的openwrt版本"'},"​")],-1)),i[30]||(i[30]=s("p",null,[l("前往"),s("a",{href:"https://help.aliyun.com/zh/ecs/enable-the-telnet-command-in-windows",target:"_blank",rel:"noreferrer"},"官网下载地址"),l("，获取需要使用的固件包， 截至今日，目前最新的小米4A 100M 的固件包为"),s("code",null,"v23.05"),l("，但本着"),s("s",null,"代码能运行，就不修改的原则"),l("，这里还是采用原贴主提供的版本，若有需要，可在openwrt刷完后，手动更新固件版本。")],-1)),i[31]||(i[31]=s("figure",null,[s("img",{src:"https://pic.0v0.day/file/stroage/2024/06/30/gxlgp4f2q6.png",alt:"imgs6",loading:"lazy",decoding:"async"})],-1)),i[32]||(i[32]=s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 官方源")]),l(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"http://downloads.openwrt.org/releases/19.07.4/targets/ramips/mt76x8/openwrt-19.07.4-ramips-mt76x8-xiaomi_mir4a-100m-squashfs-sysupgrade.bin")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#中科大源")]),l(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"http://mirrors.ustc.edu.cn/openwrt/releases/19.07.4/targets/ramips/mt76x8/openwrt-19.07.4-ramips-mt76x8-xiaomi_mir4a-100m-squashfs-sysupgrade.bin")])])]),s("button",{class:"collapse"})],-1)),i[33]||(i[33]=s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 切换到 tmp 目录（其他分区空间不够放不下镜像）")]),l(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cd"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /tmp")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"curl"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -o"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," firmware.bin"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," http://mirrors.ustc.edu.cn/openwrt/releases/19.07.4/targets/ramips/mt76x8/openwrt-19.07.4-ramips-mt76x8-xiaomi_mir4a-100m-squashfs-sysupgrade.bin")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mtd"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -e"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," OS1"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -r"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," write"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," firmware.bin"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," OS1")])])]),s("button",{class:"collapse"})],-1)),i[34]||(i[34]=s("p",null,"等待烧录完成后，会自动执行reboot，若没有reboot，手动reboot即可",-1)),i[35]||(i[35]=s("p",null,[l("ssh连接后，安装luci，使用web可视化管理openwrt（默认是："),s("a",{href:"http://192.168.1.1",target:"_blank",rel:"noreferrer"},"http://192.168.1.1"),l("）")],-1)),i[36]||(i[36]=s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"opkg"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," update"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," && "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"opkg"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," luci")])])]),s("button",{class:"collapse"})],-1)),i[37]||(i[37]=s("h2",{id:"问题点解决",tabindex:"-1"},[l("问题点解决 "),s("a",{class:"header-anchor",href:"#问题点解决","aria-label":'Permalink to "问题点解决"'},"​")],-1)),i[38]||(i[38]=s("blockquote",null,[s("p",null,"目前大多用户使用光猫拨号，路由器作为二级路由或AP，导致openwrt烧录完成后，openwrt的默认地址与光猫的默认地址192.168.1.1冲突，导致无法进入到openwrt系统中。解决方法如下：")],-1)),i[39]||(i[39]=s("p",null,"进入光猫的管理页面，手动将光猫的网关地址修改为192.168.1.x，这里以电信光猫为例",-1)),i[40]||(i[40]=s("figure",null,[s("img",{src:"https://pic.0v0.day/file/stroage/2024/06/30/gxlgpn77w6.png",alt:"imgs7",loading:"lazy",decoding:"async"})],-1)),i[41]||(i[41]=s("blockquote",null,[s("p",null,[l("解决完默认地址冲突后，使用ssh "),s("a",{href:"mailto:root@192.168.1.1"},"root@192.168.1.1"),l(" 还是无法连接到路由器？")])],-1)),i[42]||(i[42]=s("p",null,"openwrt烧录完成后，默认wan口会失去网络功能，请将网线插入lan口后，按以下步骤排查：",-1)),i[43]||(i[43]=s("p",null,"1.修改电脑ip为静态ip，保证电脑与路由器在192.168.1.x同一网段下",-1)),i[44]||(i[44]=s("p",null,[l("2.打开cmd，ping 192.168.1.1，是否是通路 "),s("img",{src:"https://pic.0v0.day/file/stroage/2024/06/30/gxlgpzhx8p.png",alt:"imgs8"})],-1)),i[45]||(i[45]=s("p",null,[l("3.使用第三方ssh工具 ssh "),s("a",{href:"mailto:root@192.168.1.1"},"root@192.168.1.1"),l(" 22 带端口连接")],-1)),i[46]||(i[46]=s("blockquote",null,[s("p",null,"opkg update执行失败，提示Signature check failed. Remove wrong Signature file")],-1)),i[47]||(i[47]=s("p",null,"进web页面 系统->software->configure opkg里注释掉option check_signature 即可",-1)),i[48]||(i[48]=s("blockquote",null,[s("p",null,"路由器已经接上网线，但opkg install 无网络")],-1)),i[49]||(i[49]=s("p",null,"进入web页面，网络->接口->配置lan口，设置网关为光猫网关，设置DNS解析",-1)),i[50]||(i[50]=s("h2",{id:"最终",tabindex:"-1"},[l("最终 "),s("a",{class:"header-anchor",href:"#最终","aria-label":'Permalink to "最终"'},"​")],-1)),i[51]||(i[51]=s("p",null,"折腾openwrt的本意就是为了安装openclash用作透明代理的，在完成一系列前置操作，安装好所有依赖后，打算安装openclash luci包时发现，内存不足… 小米4A 100M的flash只有8M，而安装openclash需要10m+，我为什么没有早一点发现 = _ = ! 拔线，关机，索然无味。",-1))]),"main-header":t(()=>[n(a.$slots,"main-header")]),"main-header-after":t(()=>[n(a.$slots,"main-header-after")]),"main-nav":t(()=>[n(a.$slots,"main-nav")]),"main-content":t(()=>[n(a.$slots,"main-content")]),"main-content-after":t(()=>[n(a.$slots,"main-content-after")]),"main-nav-before":t(()=>[n(a.$slots,"main-nav-before")]),"main-nav-after":t(()=>[n(a.$slots,"main-nav-after")]),comment:t(()=>[n(a.$slots,"comment")]),footer:t(()=>[n(a.$slots,"footer")]),aside:t(()=>[n(a.$slots,"aside")]),"aside-custom":t(()=>[n(a.$slots,"aside-custom")]),default:t(()=>[n(a.$slots,"default")]),_:3},8,["frontmatter"])}}};export{q as default};
